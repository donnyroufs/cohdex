// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         Int    @id @default(autoincrement())
  steamId    String @unique
  avatar     String
  profileUrl String

  strategies Strategy[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Map {
  id Int @id @default(autoincrement())

  strategy Strategy[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Strategy {
  id    Int    @id @default(autoincrement())
  title String
  slug  String

  // units Unit[]

  User   User? @relation(fields: [userId], references: [id])
  userId Int

  Map   Map? @relation(fields: [mapId], references: [id])
  mapId Int

  Faction   Faction @relation(fields: [factionId], references: [id], name: "userFaction")
  factionId Int

  AlliesFaction   Faction @relation(fields: [alliesFactionId], references: [id], name: "alliesFaction")
  alliesFactionId Int

  AxisFaction   Faction @relation(fields: [axisFactionId], references: [id], name: "axisFaction")
  axisFactionId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([title, userId, factionId, alliesFactionId, axisFactionId])
}

// Add faction image
model Faction {
  id Int @id @default(autoincrement())

  name         String @unique
  abbreviation String @unique
  imgUrl       String @unique

  team Team

  strategies       Strategy[] @relation("userFaction")
  alliesStrategies Strategy[] @relation("alliesFaction")
  axisStrategies   Strategy[] @relation("axisFaction")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// has to be a many to many relation
// revisit later, not important rn.
// model Unit {
//   id Int @id @default(autoincrement())

//   commands Command[]

//   createdAt  DateTime  @default(now())
//   updatedAt  DateTime  @updatedAt
//   Strategy   Strategy? @relation(fields: [strategyId], references: [id])
//   strategyId Int?
// }

model Command {
  id Int @id @default(autoincrement())

  type        UnitCommand
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UnitCommand {
  MOVE
  CAPTURE
}

enum Team {
  AXIS
  ALLIES
}
